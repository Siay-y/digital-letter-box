<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Para Minha Pessoa Favorita ðŸ’–</title>
  <style>
    :root {
      --bg: #0f0f14;
      --fg: #f7f7fb;
      --muted: #b7b7c9;
      --primary: #ff5ea8; 
      --primary-2: #8a64ff;
      --card: #151521;
      --ring: rgba(255, 94, 168, 0.6);
      --paper: #fff8f9;
      --ink: #1a1a1a;
      --heart: #ff6b9e;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
      color: var(--fg);
      background:
        radial-gradient(1200px 600px at 80% -10%, rgba(255,94,168,.20), transparent 60%),
        radial-gradient(900px 400px at -10% 110%, rgba(138,100,255,.22), transparent 60%),
        linear-gradient(180deg, #0b0b10 0%, #12121a 100%);
      min-height: 100%;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .wrap {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      max-width: 1100px;
      margin: 40px auto;
      padding: 0 20px 60px;
    }

    header {
      width: 100%;
      max-width: 1100px;
      margin: 18px auto 0;
      padding: 0 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    h1 {
      margin: 0;
      letter-spacing: .3px;
      font-size: clamp(20px, 2.5vw, 28px);
      display: flex; align-items: center; gap: .6ch; flex-wrap: wrap;
    }
    .badge { 
      font-size: .75rem; padding: 6px 10px; border-radius: 999px;
      background: linear-gradient(90deg, var(--primary), var(--primary-2));
      color: white; box-shadow: 0 6px 24px rgba(255, 94, 168, .25);
    }

    .controls { display: flex; gap: 10px; flex-wrap: wrap; }
    button, .btn {
      appearance: none; border: 0; cursor: pointer; color: var(--fg);
      background: linear-gradient(180deg, #1c1c2a, #131322);
      padding: 10px 14px; border-radius: 14px; font-weight: 600;
      box-shadow: 0 1px 0 rgba(255,255,255,.06) inset, 0 10px 30px rgba(0,0,0,.2);
      transition: transform .08s ease, box-shadow .2s ease, background .2s ease;
      outline: 2px solid transparent; outline-offset: 2px;
    }
    button:hover { transform: translateY(-1px); box-shadow: 0 14px 38px rgba(0,0,0,.35); }
    button:focus-visible { outline-color: var(--ring); }

    .btn-prim { background: linear-gradient(90deg, var(--primary), var(--primary-2)); color: #fff; }
    .btn-ghost { background: transparent; border: 1px solid rgba(255,255,255,.12); }

    .pane {
      background: color-mix(in oklab, var(--card) 85%, black 15%);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 20px; padding: 18px; position: relative; overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }

    .pane::after {
      content: ""; position: absolute; inset: -1px; pointer-events: none;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.06), transparent);
      mask: linear-gradient(to bottom, transparent, black 10%, black 90%, transparent);
      mix-blend-mode: soft-light;
    }

    .form { display: grid; gap: 12px; }
    label { font-size: .9rem; color: var(--muted); }
    input[type="text"], textarea {
      width: 100%; border: 1px solid rgba(255,255,255,.12); border-radius: 14px;
      background: rgba(255,255,255,.04); color: var(--fg);
      padding: 12px 14px; font: inherit; resize: vertical;
      transition: border-color .2s ease, background .2s ease;
    }
    textarea { min-height: 180px; }
    input:focus, textarea:focus { border-color: var(--ring); outline: none; background: rgba(255,255,255,.06); }

    .row { display: flex; gap: 10px; flex-wrap: wrap; }

    .counter { font-size: .8rem; color: var(--muted); text-align: right; }

    .letter-viewport { height: 100%; display: grid; place-items: center; padding: 12px; }
    .letter {
      width: min(560px, 100%);
      aspect-ratio: 3/2;
      background: var(--paper);
      color: var(--ink);
      border-radius: 22px;
      box-shadow: 0 30px 80px rgba(0,0,0,.35);
      position: relative;
      padding: 28px;
      overflow: hidden;
      transform-style: preserve-3d;
    }

    .letter .shine { 
      position: absolute; inset: -50% -20%; pointer-events: none;
      background: conic-gradient(from 180deg at 50% 50%, rgba(255, 190, 220, .25), transparent, rgba(138, 100, 255, .22), transparent);
      filter: blur(24px); animation: drift 12s linear infinite;
    }

    @keyframes drift { to { transform: rotate(360deg); } }

    .letter h2 { margin: 0 0 8px; font-size: 1.2rem; letter-spacing: .3px; color: #7b6a90; }
    .letter h3 { margin: 0 0 12px; font-size: 1.9rem; letter-spacing: .4px; color: #e34b7f; }
    .message {
      font-size: 1.06rem; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;
      max-height: 62%; overflow: auto; padding-right: 6px;
    }
    .signature { margin-top: 14px; font-weight: 700; color: #8b78b9; }

    .envelope { position: absolute; inset: 0; display: grid; place-items: center; pointer-events: none; }
    .flap {
      position: absolute; top: -50%; left: 50%; transform: translate(-50%, 0) rotate(0deg);
      width: 140%; height: 120%; background: linear-gradient(180deg, #ffd4e4, #ffc7dc);
      clip-path: polygon(0 0, 100% 0, 50% 60%);
      box-shadow: 0 8px 24px rgba(227, 75, 127, .25);
      transform-origin: 50% 0%; border-bottom: 2px dashed rgba(0,0,0,.05);
    }

    .envelope.open .flap { animation: openFlap 1.4s cubic-bezier(.2,.7,.2,1) forwards; }
    @keyframes openFlap { 0% { transform: translate(-50%,0) rotate(0deg); } 60% { transform: translate(-50%,0) rotate(-145deg);} 100% { transform: translate(-50%,0) rotate(-160deg);} }

    .seal {
      position: absolute; top: 8px; right: 12px; width: 64px; height: 64px; border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #ff8db8, #ff5ea8);
      color: white; display: grid; place-items: center; font-weight: 800; letter-spacing: 2px;
      transform: translateZ(30px) rotate(10deg);
      box-shadow: 0 12px 30px rgba(255,94,168,.35);
    }

    .heartline { position: absolute; bottom: 8px; left: 12px; right: 12px; height: 26px; opacity: .25; background:
      radial-gradient(circle at 10% 50%, var(--heart) 2px, transparent 3px),
      radial-gradient(circle at 20% 40%, var(--heart) 1.5px, transparent 3px),
      radial-gradient(circle at 30% 60%, var(--heart) 2px, transparent 3px),
      radial-gradient(circle at 40% 50%, var(--heart) 1.8px, transparent 3px),
      radial-gradient(circle at 50% 45%, var(--heart) 2.2px, transparent 3px),
      radial-gradient(circle at 60% 55%, var(--heart) 1.7px, transparent 3px),
      radial-gradient(circle at 70% 48%, var(--heart) 2px, transparent 3px),
      radial-gradient(circle at 80% 52%, var(--heart) 1.6px, transparent 3px),
      radial-gradient(circle at 90% 49%, var(--heart) 2px, transparent 3px);
    }

    canvas#fx { position: fixed; inset: 0; z-index: -1; }

    .toast { position: fixed; bottom: 18px; left: 50%; transform: translateX(-50%);
      background: rgba(20,20,30,.86); color: #fff; padding: 10px 14px; border-radius: 12px;
      border: 1px solid rgba(255,255,255,.12); box-shadow: 0 10px 26px rgba(0,0,0,.35);
      opacity: 0; pointer-events: none; transition: opacity .25s ease, transform .25s ease;
    }
    .toast.show { opacity: 1; transform: translate(-50%, -6px); pointer-events: auto; }

    @media (max-width: 900px) {
      .wrap { grid-template-columns: 1fr; }
      .letter { aspect-ratio: auto; min-height: 420px; }
    }

    @media print {
      body { background: white; }
      header, .editor, #fx, .toast { display: none !important; }
      .wrap { margin: 0; padding: 0; }
      .letter { box-shadow: none; border: 0; background: white; color: black; }
    }
  </style>
</head>
<body>
  <canvas id="fx"></canvas>

  <header>
    <h1>ðŸ’Œ Carta para <span id="alvoLabel">minha pessoa favorita</span> <span class="badge">Oiii, meu bem :></span></h1>
    <div class="controls">
      <button id="preview" class="btn">PrÃ©-visualizar âœ¨</button>
      <button id="share" class="btn">Compartilhar ðŸ”—</button>
    </div>
  </header>

  <main class="wrap">
    <section class="pane editor">
      <form class="form" id="form">
        <div class="row">
          <div style="flex:2; min-width: 220px;">
            <label for="nome">Nome da pessoa</label>
            <input id="nome" type="text" placeholder="Ex.: Sasa" maxlength="40" />
          </div>
          <div style="flex:3; min-width: 220px;">
            <label for="titulo">TÃ­tulo da carta</label>
            <input id="titulo" type="text" placeholder="Ex.: Para alegrar seu dia :>" maxlength="60" />
          </div>
        </div>
        <div>
          <label for="mensagem">Seu textinho especial</label>
          <textarea id="mensagem" placeholder="Escreva aqui o que seu coraÃ§Ã£o quiser dizer..." maxlength="1800"></textarea>
          <div class="counter"><span id="count">0</span>/1800 caracteres</div>
        </div>
        <div class="row">
          <button type="button" class="btn-prim" id="aplicar">Aplicar na carta</button>
          <button type="button" class="btn-ghost" id="limpar">Limpar</button>
        </div>
      </form>
    </section>

    <section class="pane letter-viewport">
      <article class="letter" id="letter">
        <div class="shine" aria-hidden></div>
        <div class="seal">ðŸ’–</div>

        <h2 id="to">Para: Minha Pessoa Favorita</h2>
        <h3 id="title">VocÃª Ã© meu lugar preferido</h3>
        <div class="message" id="previewMsg">Escreva sua mensagem e clique em "Aplicar na carta" ou "PrÃ©-visualizar" para ver aqui âœ¨
        </div>
        <div class="signature" id="sig">Com carinho, <span id="autor">Sensei</span></div>
        <div class="heartline" aria-hidden></div>
      </article>
    </section>
  </main>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    const $ = (sel, el=document) => el.querySelector(sel);
    const toast = (msg) => {
      const el = $('#toast');
      el.textContent = msg; el.classList.add('show');
      setTimeout(() => el.classList.remove('show'), 2200);
    };

    const state = {
      nome: localStorage.getItem('nome') || '',
      titulo: localStorage.getItem('titulo') || '',
      mensagem: localStorage.getItem('mensagem') || '',
      autor: localStorage.getItem('autor') || '',
    };

    // Inputs
    const nome = $('#nome');
    const titulo = $('#titulo');
    const mensagem = $('#mensagem');
    const count = $('#count');

    const to = $('#to');
    const title = $('#title');
    const previewMsg = $('#previewMsg');
    const autorSpan = $('#autor');
    const alvoLabel = $('#alvoLabel');

    const aplicar = $('#aplicar');
    const previewBtn = $('#preview');
    const share = $('#share');
    const limpar = $('#limpar');

    const envelope = $('#envelope');

    try {
      const params = new URLSearchParams(location.hash.slice(1) || location.search.slice(1));
      if (params.size) {
        state.nome = params.get('n')?.slice(0, 40) || state.nome;
        state.titulo = params.get('t')?.slice(0, 60) || state.titulo;
        state.mensagem = decodeURIComponent(params.get('m') || '') || state.mensagem;
        state.autor = params.get('a')?.slice(0, 40) || state.autor;
      }
    } catch(_){}

    nome.value = state.nome;
    titulo.value = state.titulo;
    mensagem.value = state.mensagem;

    const updateCount = () => { count.textContent = mensagem.value.length; };
    mensagem.addEventListener('input', () => { updateCount(); saveDraft(); });
    nome.addEventListener('input', saveDraft);
    titulo.addEventListener('input', saveDraft);

    $('.seal').addEventListener('dblclick', () => {
      const assinatura = prompt('Assine sua carta (seu nome):', state.autor || '');
      if (assinatura !== null) {
        state.autor = assinatura.slice(0, 40);
        autorSpan.textContent = state.autor || 'Sensei';
        localStorage.setItem('autor', state.autor);
      }
    });

    function applyToLetter(openEnvelope = true) {
      const n = (nome.value || 'Minha Pessoa Favorita').trim();
      const t = (titulo.value || 'VocÃª Ã© meu lugar preferido').trim();
      const m = (mensagem.value || '...').trim();

      to.textContent = `Para: ${n}`;
      title.textContent = t;
      previewMsg.textContent = m;
      autorSpan.textContent = state.autor || 'Sensei';
      alvoLabel.textContent = n.toLowerCase() === 'minha pessoa favorita' ? 'minha pessoa favorita' : n;

      if (openEnvelope) {
        envelope.classList.remove('open');
        void envelope.offsetWidth; 
        envelope.classList.add('open');
        setTimeout(()=> confetti(24), 500);
      }
    }

    function saveDraft() {
      localStorage.setItem('nome', nome.value);
      localStorage.setItem('titulo', titulo.value);
      localStorage.setItem('mensagem', mensagem.value);
    }

    aplicar.addEventListener('click', () => { applyToLetter(); toast('Carta atualizada âœ¨'); });
    previewBtn.addEventListener('click', () => { applyToLetter(); });

    share.addEventListener('click', async () => {
      const url = new URL(location.href.split('#')[0]);
      url.hash = new URLSearchParams({
        n: nome.value,
        t: titulo.value,
        m: mensagem.value,
        a: state.autor || ''
      }).toString();
      const link = url.toString();
      try {
        await navigator.clipboard.writeText(link);
        toast('Link copiado para a Ã¡rea de transferÃªncia!');
      } catch {
        prompt('Copie o link para compartilhar:', link);
      }
    });

    limpar.addEventListener('click', () => {
      nome.value = '';
      titulo.value = '';
      mensagem.value = '';
      updateCount();
      saveDraft();
      toast('Campos limpos');
    });

    updateCount();
    applyToLetter(false);

    const fx = document.getElementById('fx');
    const ctx = fx.getContext('2d');
    let W, H; const DPR = Math.min(devicePixelRatio || 1, 2);
    function resize() {
      W = innerWidth; H = innerHeight; fx.width = W * DPR; fx.height = H * DPR; ctx.scale(DPR, DPR);
    }
    resize(); addEventListener('resize', resize);

    let particles = [];
    function spawn(x, y, vx, vy, life, kind='heart') { particles.push({x, y, vx, vy, life, max: life, kind}); }

    function heart(ctx, x, y, r) {
      ctx.beginPath();
      const d = r;
      ctx.moveTo(x, y + d/4);
      ctx.bezierCurveTo(x - d, y - d/2, x - d, y + d, x, y + d);
      ctx.bezierCurveTo(x + d, y + d, x + d, y - d/2, x, y + d/4);
      ctx.closePath();
    }

    function confetti(n=16) {
      for (let i=0;i<n;i++) {
        const x = innerWidth/2, y = 0;
        const vx = (Math.random() - .5) * 3;
        const vy = 2 + Math.random() * 2.5;
        spawn(x, y, vx, vy, 220 + Math.random()*80, 'dot');
      }
    }

    let mouse = {x: W/2, y: H/2};
    window.addEventListener('mousemove', e => { mouse = {x: e.clientX, y: e.clientY}; for (let i=0;i<2;i++) spawn(mouse.x, mouse.y, (Math.random()-.5)*.8, (Math.random()-.5)*.8, 80+Math.random()*40, 'heart'); });

    function loop() {
      ctx.clearRect(0,0,W,H);
      for (let i=particles.length-1; i>=0; i--) {
        const p = particles[i];
        p.x += p.vx; p.y += p.vy; p.vy += p.kind==='dot' ? 0.03 : 0.005; p.life--;
        const a = Math.max(p.life / p.max, 0);
        if (p.kind === 'heart') {
          ctx.save(); ctx.globalAlpha = a * 0.9; ctx.fillStyle = '#ff6b9e'; ctx.translate(p.x, p.y); ctx.rotate((p.max-p.life)/30); heart(ctx, 0, 0, 6); ctx.fill(); ctx.restore();
        } else {
          ctx.save(); ctx.globalAlpha = a; ctx.fillStyle = ['#ff5ea8','#8a64ff','#ffd166'][i%3]; ctx.fillRect(p.x, p.y, 4, 8); ctx.restore();
        }
        if (p.life <= 0 || p.y > H+40) particles.splice(i,1);
      }
      requestAnimationFrame(loop);
    }
    loop();

    window.addEventListener('keydown', (e) => {
      if (e.altKey && e.key.toLowerCase() === 'p') { e.preventDefault(); applyToLetter(); }
      if (e.ctrlKey && e.key.toLowerCase() === 's') { e.preventDefault(); share.click(); }
    });
  </script>
</body>
</html>
